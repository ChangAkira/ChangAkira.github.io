let RightMenu=(()=>{let c=volantis.GLOBAL_CONFIG.plugins.rightmenu,s=volantis.GLOBAL_CONFIG.plugins.message.enable&&volantis.GLOBAL_CONFIG.plugins.message.rightmenu.enable,d={},u=document.getElementById("rightmenu-wrapper"),m=document.getElementById("rightmenu-content"),p=document.getElementById("printHtml"),g=document.getElementById("menuMusic"),y=document.getElementById("readingModel"),t=document.getElementById("read_bkg"),M=document.querySelectorAll(".menuLoad-Content"),o=document.querySelector(".menu-Option"),v=document.querySelector('.menu-Option[data-fn-type="searchWord"]'),C=document.querySelector('.menu-Option[data-fn-type="copyText"]'),O=document.querySelector('.menu-Option[data-fn-type="copyPaste"]'),b=document.querySelector('.menu-Option[data-fn-type="copySelect"]'),h=document.querySelector('.menu-Option[data-fn-type="copyCut"]'),D=document.querySelector('.menu-Option[data-fn-type="copyHref"]'),S=document.querySelector('.menu-Option[data-fn-type="copySrc"]'),f=document.querySelector('.menu-Option[data-fn-type="copyImg"]'),w=document.querySelector('.menu-Option[data-fn-type="openTab"]'),e=document.querySelector("#menuMusic .backward"),r=document.querySelector("#menuMusic .toggle"),n=document.querySelector("#menuMusic .forward"),q=/^((https|http)?:\/\/)+[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;return d.init=()=>{DOMController.visible(g,!1),DOMController.visible(o,!1),t&&t.parentNode.removeChild(t);var e=document.createElement("div");e.className="common_read_bkg common_read_hide",e.id="read_bkg",window.document.body.appendChild(e)},d.initEvent=()=>{window.document.oncontextmenu=e=>e.ctrlKey||document.body.offsetWidth<=500?(d.hideMenu(),!0):d.popMenu(e),u.oncontextmenu=e=>(e.stopPropagation(),e.preventDefault(),!1),window.removeEventListener("blur",d.hideMenu),window.addEventListener("blur",d.hideMenu),document.body.removeEventListener("click",d.hideMenu),document.body.addEventListener("click",d.hideMenu),n&&r&&n&&(e.onclick=e=>{e.preventDefault(),e.stopPropagation(),RightMenuAplayer.aplayerBackward()},r.onclick=e=>{e.preventDefault(),e.stopPropagation(),RightMenuAplayer.aplayerToggle()},n.onclick=e=>{e.preventDefault(),e.stopPropagation(),RightMenuAplayer.aplayerForward()})},d.popMenu=e=>{var t=e.clientX,o=e.clientY,r=document.documentElement.clientWidth||document.body.clientWidth,n=document.documentElement.clientHeight||document.body.clientHeight;try{d.setMenuItem(e),DOMController.visible(u),u.focus(),u.style.zIndex="-2147483648";var l=m.offsetWidth,i=m.offsetHeight,a=r<t+l?t-l+10:t,c=n<o+i?o-i+10:o,c=n<o+i&&c<i&&o<i?c+(n-i-c-10):c;u.style.left=a+"px",u.style.top=c+"px",u.style.zIndex="2147483648",volantis.GLOBAL_CONFIG.plugins.message.rightmenu.notice&&d.showMessage()}catch(e){return u.blur(),console.error(e),!0}return!1},d.showMessage=()=>{var e="true"===localStorage.getItem("NoticeRightMenu");s&&!e&&VolantisApp.message("右键菜单","唤醒原系统菜单请使用：<kbd>Ctrl</kbd> + <kbd>右键</kbd>",{icon:c.faicon+" fa-exclamation-square red",time:9e3},()=>{localStorage.setItem("NoticeRightMenu","true")})},d.setMenuItem=e=>{let t=!1,r=e.target,n=window.getSelection().toString();if(DOMController.visible(w,!1),"input"===r.tagName.toLowerCase()||"textarea"===r.tagName.toLowerCase()){let o=r.value;0<o.length?(DOMController.visible(b),b.onclick=()=>{e.preventDefault(),r.select()}):DOMController.visible(b,!1),n?(DOMController.visible(h),h.onclick=()=>{var e=r.selectionStart,t=r.selectionEnd;d.copyString(n),r.value=o.substring(0,e)+o.substring(t,o.length),r.selectionStart=e,r.selectionEnd=e,r.focus()}):DOMController.visible(h,!1),d.readClipboard().then(e=>{e?(DOMController.visible(O),O.onclick=()=>{d.insertAtCaret(r,e)}):DOMController.visible(O,!1)}).catch(e=>{console.error(e),DOMController.visible(O,!1)})}else DOMController.visible(b,!1),DOMController.visible(O,!1),DOMController.visible(h,!1);let o=r.href,l=(o&&q.test(o)?(t=!0,DOMController.visible(D),DOMController.visible(w),D&&(D.onclick=()=>{d.copyString(o)}),w.onclick=()=>{window.open(o)}):DOMController.visible(D,!1),r.currentSrc);l&&q.test(l)?(t=!0,DOMController.visible(S),DOMController.visible(w),S.onclick=()=>{d.copyString(l)},w.onclick=()=>{window.open(l)}):DOMController.visible(S,!1),l&&q.test(l)&&l.trimEnd().endsWith(".png")?(t=!0,DOMController.visible(f),f.onclick=()=>{d.writeClipImg(e,e=>{e&&s&&VolantisApp.message("系统提示","图片复制成功！",{icon:c.faicon+" fa-images"})},e=>{s&&VolantisApp.message("系统提示","复制失败："+e,{icon:c.faicon+" fa-exclamation-square red"})})}):DOMController.visible(f,!1),n?(t=!0,DOMController.visible(C),DOMController.visible(v),C.onclick=()=>{d.copyString(n)},v&&(v.onclick=()=>{OpenSearch(n)})):(DOMController.visible(C,!1),DOMController.visible(v,!1));var i=document.querySelector("#post.article")||null;let a=window.location.pathname;i?(DOMController.visible(p),DOMController.visible(y),p&&(p.onclick=()=>{window.location.pathname===a?s&&VolantisApp.question("",'是否打印当前页面？<br><em style="font-size: 80%">建议打印时勾选背景图形</em><br>',{},()=>{d.printHtml()}):d.hideMenu()}),y&&(y.onclick=()=>{window.location.pathname,a,d.readingModel()})):(DOMController.visible(p,!1),DOMController.visible(y,!1)),volantis.GLOBAL_CONFIG.plugins.aplayer.enable&&"undefined"!=typeof RightMenuAplayer&&void 0!==RightMenuAplayer.APlayer.player?c.music_alwaysShow?DOMController.visible(g):"play"===RightMenuAplayer.APlayer.status||"undefined"===RightMenuAplayer.APlayer.status?(t=!0,DOMController.visible(g)):DOMController.visible(g,!1):DOMController.visible(g,!1),M.forEach(e=>{DOMController.visible(e,!t)}),volantis.GLOBAL_CONFIG.plugins.aplayer.enable&&c.layout.includes("music")&&RightMenuAplayer.checkAPlayer()},d.hideMenu=()=>{DOMController.visible(u,!1)},d.copyString=e=>{VolantisApp.utilWriteClipText(e).then(()=>{s&&VolantisApp.messageCopyright()}).catch(e=>{s&&VolantisApp.message("系统提示",e,{icon:c.faicon+" fa-exclamation-square red"})})},d.writeClipText=t=>{try{return navigator.clipboard.writeText(t).then(()=>Promise.resolve()).catch(e=>Promise.reject(e))}catch(e){var o=document.createElement("input");o.setAttribute("readonly","readonly"),document.body.appendChild(o),o.setAttribute("value",t),o.select();try{var r=document.execCommand("copy");return document.body.removeChild(o),r&&"unsuccessful"!==r?Promise.resolve():Promise.reject("复制文本失败!")}catch(e){return document.body.removeChild(o),Promise.reject("当前浏览器不支持复制功能，请检查更新或更换其他浏览器操作!")}}},d.writeClipImg=async function(t,o,r){var n=c.customPicUrl.enable?t.target.currentSrc.replace(c.customPicUrl.old,c.customPicUrl.new):t.target.currentSrc,t=t.target.parentElement;try{var e=await(await fetch(n)).blob();await navigator.clipboard.write([new ClipboardItem({[e.type]:e})]).then(()=>{o(!0)},e=>{console.error("图片复制失败：",e),r(e)})}catch(e){var l,i,a,n=document;try{n.body.createTextRange?((l=document.body.createTextRange()).moveToElementText(t),l.select()):window.getSelection&&(i=window.getSelection(),(a=document.createRange()).selectNodeContents(t),i.removeAllRanges(),i.addRange(a)),document.execCommand("copy"),window.getSelection().removeAllRanges(),o(!1)}catch(e){console.error(e),r("不支持复制当前图片！")}}},d.readClipboard=async()=>{var e=await navigator.permissions.query({name:"clipboard-read"});return"granted"===e.state||"prompt"===e.state?navigator.clipboard.readText().then(e=>e).catch(e=>Promise.reject(e)):Promise.reject(e)},d.insertAtCaret=(e,t)=>{var o,r=e.selectionStart,n=e.selectionEnd;document.selection?(e.focus(),document.selection.createRange().text=t,e.focus()):r||"0"==r?(o=e.scrollTop,e.value=e.value.substring(0,r)+t+e.value.substring(n,e.value.length),e.focus(),e.selectionStart=r+t.length,e.selectionEnd=r+t.length,e.scrollTop=o):(e.value+=t,e.focus())},d.printHtml=()=>{volantis.isReadModel&&d.readingModel(),DOMController.setAttribute("details","open","true"),DOMController.remove(".cus-article-bkg"),DOMController.remove(".iziToast-overlay"),DOMController.remove(".iziToast-wrapper"),DOMController.remove(".prev-next"),DOMController.remove("footer"),DOMController.remove("#l_header"),DOMController.remove("#l_cover"),DOMController.remove("#l_side"),DOMController.remove("#comments"),DOMController.remove("#s-top"),DOMController.remove("#BKG"),DOMController.remove("#rightmenu-wrapper"),DOMController.remove(".nav-tabs"),DOMController.remove(".parallax-mirror"),DOMController.remove(".new-meta-item.share"),DOMController.remove("div.footer"),DOMController.setStyle("body","backgroundColor","unset"),DOMController.setStyle("#l_main","width","100%"),DOMController.setStyle("#post","boxShadow","none"),DOMController.setStyle("#post","background","none"),DOMController.setStyle("#post","padding","0"),DOMController.setStyle("h1","textAlign","center"),DOMController.setStyle("h1","fontWeight","600"),DOMController.setStyle("h1","fontSize","2rem"),DOMController.setStyle("h1","marginBottom","20px"),DOMController.setStyle(".tab-pane","display","block"),DOMController.setStyle(".tab-content","borderTop","none"),DOMController.setStyle(".highlight>table pre","whiteSpace","pre-wrap"),DOMController.setStyle(".highlight>table pre","wordBreak","break-all"),DOMController.setStyle(".fancybox img","height","auto"),DOMController.setStyle(".fancybox img","weight","auto"),setTimeout(()=>{window.print(),document.body.innerHTML="",window.location.reload()},50)},d.readingModel=()=>{var e;"function"==typeof ScrollReveal&&ScrollReveal().clean("#comments"),DOMController.fadeToggle(document.querySelector("#l_header")),DOMController.fadeToggle(document.querySelector("footer")),DOMController.fadeToggle(document.querySelector("#s-top")),DOMController.fadeToggle(document.querySelector(".article-meta#bottom")),DOMController.fadeToggle(document.querySelector(".prev-next")),DOMController.fadeToggle(document.querySelector("#l_side")),DOMController.fadeToggle(document.querySelector("#comments")),DOMController.toggleClass(document.querySelector("#l_main"),"common_read"),DOMController.toggleClass(document.querySelector("#l_main"),"common_read_main"),DOMController.toggleClass(document.querySelector("#l_body"),"common_read"),DOMController.toggleClass(document.querySelector("#safearea"),"common_read"),DOMController.toggleClass(document.querySelector("#pjax-container"),"common_read"),DOMController.toggleClass(document.querySelector("#read_bkg"),"common_read_hide"),DOMController.toggleClass(document.querySelector("h1"),"common_read_h1"),DOMController.toggleClass(document.querySelector("#post"),"post_read"),DOMController.toggleClass(document.querySelector("#l_cover"),"read_cover"),DOMController.toggleClass(document.querySelector(".widget.toc-wrapper"),"post_read"),volantis.isReadModel=void 0===volantis.isReadModel||!volantis.isReadModel,volantis.isReadModel?(e={backgroundColor:"var(--color-read-post)",icon:c.faicon+" fa-book-reader",time:5e3},s&&VolantisApp.message("系统提示","阅读模式已开启，您可以点击屏幕空白处退出。",e),document.querySelector("#l_body").removeEventListener("click",d.readingModel),document.querySelector("#l_body").addEventListener("click",e=>{DOMController.hasClass(e.target,"common_read")&&d.readingModel()})):(document.querySelector("#l_body").removeEventListener("click",d.readingModel),document.querySelector("#post").removeEventListener("click",d.readingModel))},{init:(e=!1)=>{d.init(),d.initEvent(),e&&s&&VolantisApp.message("系统提示","自定义右键注册成功。")},destroy:(e=!1)=>{d.hideMenu(),window.document.oncontextmenu=()=>!0,e&&s&&VolantisApp.message("系统提示","自定义右键注销成功。")},hideMenu:d.hideMenu,readingModel:d.readingModel}})();Object.freeze(RightMenu),volantis.requestAnimationFrame(()=>{"loading"!==document.readyState?(RightMenu.init(),volantis.pjax.send(()=>{RightMenu.hideMenu()})):document.addEventListener("DOMContentLoaded",function(){RightMenu.init(),volantis.pjax.send(()=>{RightMenu.hideMenu()})})});